Meshtastic:

Compilar código:

https://meshtastic.org/docs/development/firmware/build/

En el platformio.ini he tenido que agregar algobsec para que compile

build_flags = 

  -L"D:/onedrive/proyectos/meshtastic/firmware/.pio/libdeps/tbeam-s3-core/bsec2/src/esp32s3"
  ${esp32s3_base.build_flags} 

Modificar MQTT.cpp

void MQTT::sendSubscriptions()
{
#if HAS_NETWORKING
    pubSub.subscribe("art/lora/meshtastic", 0); // FIXME, is QOS 1 right
	
Modificar onReceive:

    if (strcmp(topic, "art/lora/meshtastic/respuesta") == 0) {
        LOG_INFO("Ignoring response message to avoid loops");
        return;
    }
    if (std::string(topic).find("art/lora/meshtastic") != std::string::npos){
        pinMode(46, OUTPUT);
        if (std::string(topic).find("apagar") != std::string::npos) {
            digitalWrite(46, HIGH);
            publish("art/lora/meshtastic/respuesta/encendido", payload, length, false);
        } else if (std::string(topic).find("encender") != std::string::npos) {
            digitalWrite(46, LOW);
            publish("art/lora/meshtastic/respuesta/apagado", payload, length, false);
        }
        if(screen){
            screen->print("Recibido, Ipe!");        // Escribe el mensaje en el buffer de la pantalla
            screen->forceDisplay(); 
        }
    }

	
	
Modificar icono UMA en icon.xbm

  static uint8_t icon_bits[] = {
  0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 
  0x00, 0x00, 0x10, 0x08, 0x00, 0x00, 0x08, 0x00, 0x00, 0x10, 0x00, 0x00, 
  0x00, 0x08, 0x00, 0x00, 0x10, 0x88, 0xC5, 0x01, 0x8B, 0x03, 0x00, 0x10, 
  0x48, 0x26, 0x82, 0x4C, 0x04, 0x00, 0x10, 0x48, 0x04, 0x82, 0x48, 0x04, 
  0x00, 0x10, 0x48, 0xC4, 0x83, 0xC8, 0x07, 0x00, 0x10, 0x48, 0x24, 0x82, 
  0x48, 0x00, 0x00, 0x10, 0x48, 0x26, 0x83, 0x48, 0x04, 0x00, 0xF0, 0x8B, 
  0xC5, 0x02, 0x8F, 0x03, 0x00, 0x00, 0x00, 0x04, 0x00, 0x00, 0x00, 0x00, 
  0x00, 0xC0, 0x03, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 
  0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x20, 0x00, 
  0x00, 0x00, 0x00, 0x00, 0x80, 0x10, 0x02, 0x00, 0x00, 0x00, 0x00, 0x80, 
  0x00, 0x02, 0x00, 0x00, 0x00, 0x00, 0x80, 0x38, 0x1A, 0x0E, 0x8B, 0xC3, 
  0x01, 0x80, 0x44, 0x26, 0x91, 0x4C, 0x24, 0x02, 0x80, 0x40, 0x22, 0x91, 
  0x08, 0x24, 0x00, 0x80, 0x78, 0x22, 0x9F, 0x88, 0xC7, 0x01, 0x88, 0x44, 
  0x22, 0x81, 0x48, 0x04, 0x02, 0x88, 0x64, 0x26, 0x91, 0x4C, 0x26, 0x02, 
  0x70, 0x58, 0x1A, 0x0E, 0x8B, 0xC5, 0x01, 0x00, 0x00, 0x00, 0x00, 0x08, 
  0x00, 0x00, 0x00, 0x00, 0x00, 0x80, 0x07, 0x00, 0x00, 0x00, 0x00, 0x00, 
  0x00, 0x00, 0x00, 0x00, };
  
# Para flashear esp32-s3 
* apagar
* pulsar el boton separado manteniendo
* enchufar (y en https://flasher.meshtastic.org/ comporbar que aparece un puerto )



# Para cargar y descargar la configuracion, acceder al log, etc, hay un meshtastic.exe

.\meshtastic.exe --port COM5 --seriallog
.\meshtastic.exe --port COM5 --configure D:\onedrive\proyectos\meshtastic\config_backup.yaml
.\meshtastic.exe --port COM5 --export o algo asi
.\meshtastic.exe --port COM5 --noproto (muy importante para depurar)


# Mensajes desde el exterior

Tienen el prefijo /art/lora/2/json/mqtt/ (importante la barra final, por la suscripción a /+)
Son reenviados a la red
Se discute en https://www.reddit.com/r/meshtastic/comments/1io5w6k/how_to_send_messages_to_the_mesh_with_mqtt/
También en https://www.reddit.com/r/meshtastic/comments/1io5w6k/how_to_send_messages_to_the_mesh_with_mqtt/
Formato {"from":143407892,"type":"sendtext","payload": "Esto es MQTT hablando prueba"}
El from debe ser el gateway 
He leido que mejor que todos se configuren como client en el manual de meshtastit


#Motor

https://chatgpt.com/share/67b6c5be-065c-8004-80fc-d331e02e2d78

	